{% extends "base.html" %}

{% block title %}–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ–±–º–µ–Ω–∞{% endblock %}

{% block content %}
    <div class="login-form">
        {% if user.is_authenticated %}
            <h2 style="text-align: center;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –æ–±–º–µ–Ω–∞!</h2>

            <!-- –ü–æ–∏—Å–∫–æ–≤–∞—è —Ñ–æ—Ä–º–∞ -->
            <form method="get" class="filter-form" style="margin-bottom: 20px;">
                <input type="text" name="q" placeholder="–ü–æ–∏—Å–∫..." value="{{ query|default:'' }}">

                <select name="category">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    {% for key, val in categories.items %}
                        <option value="{{ key }}" {% if key == category %}selected{% endif %}>{{ val }}</option>
                    {% endfor %}
                </select>

                <select name="condition">
                    <option value="">–í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è</option>
                    {% for key, val in conditions.items %}
                        <option value="{{ key }}" {% if key == condition %}selected{% endif %}>{{ val }}</option>
                    {% endfor %}
                </select>

                <button type="submit">–ü–æ–∏—Å–∫</button>
            </form>

            <!-- –û–±—ä—è–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö -->
            <table border="1" cellpadding="10" cellspacing="0" style="width:100%; background:white;">
                <thead>
                    <tr>
                        <th>
                            <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}{% if condition %}condition={{ condition }}&{% endif %}sort={% if sort_by == 'title' %}-title{% else %}title{% endif %}">
                                –ó–∞–≥–æ–ª–æ–≤–æ–∫
                                {% if sort_by == 'title' %}‚ñ≤{% elif sort_by == '-title' %}‚ñº{% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}{% if condition %}condition={{ condition }}&{% endif %}sort={% if sort_by == 'category' %}-category{% else %}category{% endif %}">
                                –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                                {% if sort_by == 'category' %}‚ñ≤{% elif sort_by == '-category' %}‚ñº{% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}{% if condition %}condition={{ condition }}&{% endif %}sort={% if sort_by == 'condition' %}-condition{% else %}condition{% endif %}">
                                –°–æ—Å—Ç–æ—è–Ω–∏–µ
                                {% if sort_by == 'condition' %}‚ñ≤{% elif sort_by == '-condition' %}‚ñº{% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}{% if condition %}condition={{ condition }}&{% endif %}sort={% if sort_by == 'description' %}-description{% else %}description{% endif %}">
                                –û–ø–∏—Å–∞–Ω–∏–µ
                                {% if sort_by == 'description' %}‚ñ≤{% elif sort_by == '-description' %}‚ñº{% endif %}
                            </a>
                        </th>
                        <th>
                            <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}{% if condition %}condition={{ condition }}&{% endif %}sort={% if sort_by == 'created_at' %}-created_at{% else %}created_at{% endif %}">
                                –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
                                {% if sort_by == 'created_at' %}‚ñ≤{% elif sort_by == '-created_at' %}‚ñº{% endif %}
                            </a>
                        </th>
                        <th>–û—Ç–æ–∑–≤–∞—Ç—å—Å—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for ad in ads %}
                        <tr>
                            <td>{{ ad.title }}</td>
                            <td>{{ ad.get_category_display }}</td>
                            <td>{{ ad.get_condition_display }}</td>
                            <td>{{ ad.description }}</td>
                            <td>{{ ad.created_at|date:"d.m.Y H:i" }}</td>
                            <td><a href="{% url 'create_proposal' ad.id %}">üì©</a></td>
                        </tr>
                    {% empty %}
                        <tr><td colspan="6">–û–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–µ—Ç.</td></tr>
                    {% endfor %}
                </tbody>
            </table>

            {% if offer_ad %}
                <div style="margin-top: 30px;">
                    <h3>–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ–±–º–µ–Ω–∞</h3>
                    <form method="post" action="{% url 'create_exchange' %}">
                        {% csrf_token %}
                        <input type="hidden" name="ad_receiver_id" value="{{ offer_ad.id }}">
                        <br>
                        <label>–í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—ë –æ–±—ä—è–≤–ª–µ–Ω–∏–µ:</label>
                        <select name="ad_sender_id" required>
                            {% for ad in user_ads %}
                                <option value="{{ ad.id }}">{{ ad.title }}</option>
                            {% endfor %}
                        </select>
                        <br>
                        <input type="text" name="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é" required>
<!--                        <textarea name="comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—é" required></textarea>-->
                        <br>
                        <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ</button>
                    </form>
                </div>
            {% endif %}

            <div class="pagination" style="margin-top: 20px;">
                {% if page_obj.has_previous %}
                    <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}{% if condition %}condition={{ condition }}&{% endif %}page={{ page_obj.previous_page_number }}">‚Üê –ù–∞–∑–∞–¥</a>
                {% endif %}

                <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}</span>

                {% if page_obj.has_next %}
                    <a href="?{% if query %}q={{ query }}&{% endif %}{% if category %}category={{ category }}&{% endif %}{% if condition %}condition={{ condition }}&{% endif %}page={{ page_obj.next_page_number }}">–í–ø–µ—Ä—ë–¥ ‚Üí</a>
                {% endif %}
            </div>
        {% else %}
            <form method="post">
                {% csrf_token %}
                <h2>–í—Ö–æ–¥</h2>
                <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω" required>
                <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
                <button type="submit">–í–æ–π—Ç–∏</button>
                <p>–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? <a href="{% url 'register' %}">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a></p>
            </form>
        {% endif %}
    </div>
{% endblock %}
